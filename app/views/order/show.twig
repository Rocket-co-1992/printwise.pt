{% extends "layout/main.twig" %}

{% block title %}Detalhes do Pedido - PrintWise{% endblock %}

{% block content %}
<div class="card shadow">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
        <h4 class="mb-0">Pedido #{{ order.id }}</h4>
        <a href="/order" class="btn btn-light btn-sm">Voltar aos Pedidos</a>
    </div>
    <div class="card-body">
        <div class="row mb-4">
            <div class="col-md-6">
                <h5>Informações do Pedido</h5>
                <table class="table">
                    <tbody>
                        <tr>
                            <th scope="row" width="40%">Número do Pedido</th>
                            <td>{{ order.id }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Data do Pedido</th>
                            <td>{{ order.created_at|date("d/m/Y H:i") }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Status</th>
                            <td>
                                {% if order.status == 'pending' %}
                                    <span class="badge bg-warning">Pendente</span>
                                {% elseif order.status == 'processing' %}
                                    <span class="badge bg-info">Em Processamento</span>
                                {% elseif order.status == 'completed' %}
                                    <span class="badge bg-success">Concluído</span>
                                {% elseif order.status == 'cancelled' %}
                                    <span class="badge bg-danger">Cancelado</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Total</th>
                            <td>€{{ order.total|number_format(2, ',', '.') }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-md-6">
                <h5>Detalhes do Produto</h5>
                <div class="card">
                    <div class="row g-0">
                        <div class="col-md-4">
                            <img src="{{ order.product.image_url|default('/assets/images/default-product.jpg') }}" 
                                 class="img-fluid rounded-start" 
                                 alt="{{ order.product.name }}">
                        </div>
                        <div class="col-md-8">
                            <div class="card-body">
                                <h5 class="card-title">{{ order.product.name }}</h5>
                                <p class="card-text">Quantidade: {{ order.quantity }}</p>
                                <p class="card-text">Preço unitário: €{{ order.product.price|number_format(2, ',', '.') }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <h5>Especificações</h5>
            <div class="card">
                <div class="card-body">
                    {% if order.specifications %}
                        {{ order.specifications|nl2br }}
                    {% else %}
                        <p class="text-muted">Nenhuma especificação fornecida.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="mt-4">
            <h5>Arquivos Enviados</h5>
            {% if order.files and order.files|length > 0 %}
                <div class="list-group">
                    {% for file in order.files %}
                        <a href="/assets/uploads/{{ file.path }}" class="list-group-item list-group-item-action" target="_blank">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">{{ file.original_name }}</h6>
                                <small>{{ file.size|format_bytes }}</small>
                            </div>
                            <small class="text-muted">Clique para baixar</small>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info">
                    Nenhum arquivo enviado para este pedido.
                </div>
            {% endif %}
        </div>

        <div class="mt-4">
            <h5>Atualizações do Pedido</h5>
            {% if order.updates and order.updates|length > 0 %}
                <div class="timeline">
                    {% for update in order.updates %}
                        <div class="timeline-item">
                            <div class="timeline-marker"></div>
                            <div class="timeline-content">
                                <h6 class="mb-1">{{ update.created_at|date("d/m/Y H:i") }}</h6>
                                <p>{{ update.message }}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info">
                    Nenhuma atualização para este pedido.
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    .timeline {
        position: relative;
        margin: 0 0 30px 0;
        padding: 0;
        list-style: none;
    }
    
    .timeline::before {
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        width: 3px;
        background: #dee2e6;
        left: 31px;
        margin: 0;
        border-radius: 2px;
    }
    
    .timeline-item {
        position: relative;
        margin-bottom: 15px;
    }
    
    .timeline-marker {
        position: absolute;
        left: 20px;
        top: 0;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: #007bff;
        border: 3px solid #fff;
        z-index: 1;
    }
    
    .timeline-content {
        margin-left: 60px;
        background: #f8f9fa;
        padding: 10px 15px;
        border-radius: 5px;
    }
</style>
{% endblock %}